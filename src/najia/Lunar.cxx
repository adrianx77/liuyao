#include <stdlib.h>
#include <stdio.h>
#include <time.h>
#include "Lunar.hxx"
#include "../base/Error.hxx"

#define COUNTOF(X) (sizeof(X)/sizeof((X)[0]))

namespace Zhouyi{

enum {
	cvalue20 = 0,
	cvalue21,
	cvalue22
};

typedef struct 
{
	TIANGAN_ID gan;
	DIZHI_ID   zhi;
}GANZHI;



static double ctable[] = {4.6295, 3.87, 4.15};
GANZHI ganZhiTable[] = 
{
	{TGID_JIA,DZID_ZI} ,{TGID_YI,DZID_CHOU},{TGID_BING,DZID_YIN},{TGID_DING,DZID_MAO},{TGID_WU,DZID_CHEN},{TGID_JI,DZID_SI},{TGID_GEN,DZID_WU},{TGID_XIN,DZID_WEI},{TGID_REN,DZID_SHEN},{TGID_GUI,DZID_YOU},{TGID_JIA,DZID_XU},{TGID_YI,DZID_HAI},
	{TGID_BING,DZID_ZI},{TGID_DING,DZID_CHOU},{TGID_WU,DZID_YIN},{TGID_JI,DZID_MAO},{TGID_GEN,DZID_CHEN},{TGID_XIN,DZID_SI},{TGID_REN,DZID_WU},{TGID_GUI,DZID_WEI},{TGID_JIA,DZID_SHEN},{TGID_YI,DZID_YOU},{TGID_BING,DZID_XU},{TGID_DING,DZID_HAI},
	{TGID_WU,DZID_ZI}  ,{TGID_JI,DZID_CHOU},{TGID_GEN,DZID_YIN},{TGID_XIN,DZID_MAO},{TGID_REN,DZID_CHEN},{TGID_GUI,DZID_SI},{TGID_JIA,DZID_WU},{TGID_YI,DZID_WEI},{TGID_BING,DZID_SHEN},{TGID_DING,DZID_YOU},{TGID_WU,DZID_XU},{TGID_JI,DZID_HAI},
	{TGID_GEN,DZID_ZI} ,{TGID_XIN,DZID_CHOU},{TGID_REN,DZID_YIN},{TGID_GUI,DZID_MAO},{TGID_JIA,DZID_CHEN},{TGID_YI,DZID_SI},{TGID_BING,DZID_WU},{TGID_DING,DZID_WEI},{TGID_WU,DZID_SHEN},{TGID_JI,DZID_YOU},{TGID_GEN,DZID_XU},{TGID_XIN,DZID_HAI},
	{TGID_REN,DZID_ZI} ,{TGID_GUI,DZID_CHOU},{TGID_JIA,DZID_YIN},{TGID_YI,DZID_MAO},{TGID_BING,DZID_CHEN},{TGID_DING,DZID_SI},{TGID_WU,DZID_WU},{TGID_JI,DZID_WEI},{TGID_GEN,DZID_SHEN},{TGID_XIN,DZID_YOU},{TGID_REN,DZID_XU},{TGID_GUI,DZID_HAI},
};

static const int yearNumber[] = {
    0x9, 0xE, 0x13, 0x18, 0x1E, 0x23, 0x28, 0x2D, 0x33, 0x38, //1900-1909
	0x1, 0x6, 0xC, 0x11, 0x16, 0x1B, 0x21, 0x26, 0x2B, 0x30, //1910-1919
	0x36, 0x3B, 0x4, 0x9, 0xF, 0x14, 0x19, 0x1E, 0x24, 0x36, //1920-1929
	0x2E, 0x33, 0x39, 0x2, 0x7, 0xC, 0x12, 0x17, 0x1C, 0x2E, //1930-1939
	0x27, 0x2C, 0x31, 0x36, 0x0, 0x5, 0xA, 0xF, 0x15, 0x1A, //1940-1949
	0x1F, 0x24, 0x2A, 0x2F, 0x34, 0x39, 0x3, 0x8, 0xD, 0x12, //1950-1959
	0x18, 0x1D, 0x22, 0x27, 0x2D, 0x32, 0x37, 0x0, 0x6, 0xB, //1960-1969
	0x10, 0x15, 0x1B, 0x20, 0x25, 0x2A, 0x30, 0x35, 0x3A, 0x3, //1970-1979
	0x9, 0xE, 0x13, 0x18, 0x1E, 0x23, 0x28, 0x2D, 0x33, 0x38, //1980-1989
	0x1, 0x6, 0xC, 0x11, 0x16, 0x1B, 0x21, 0x26, 0x2B, 0x30, //1990-1999
	0x36, 0x3B, 0x4, 0x9, 0xF, 0x14, 0x19, 0x1E, 0x24, 0x29, //2000-2009
	0x2E, 0x33, 0x39, 0x2, 0x7, 0xC, 0x12, 0x17, 0x1C, 0x21, //2010-2019
	0x27, 0x2C, 0x31, 0x36, 0x0, 0x5, 0xA, 0xF, 0x15, 0x1A, //2020-2029
	0x1F, 0x24, 0x2A, 0x2F, 0x34, 0x39, 0x3, 0x8, 0xD, 0x12, //2030-2039
	0x18, 0x1D, 0x22, 0x27, 0x2D, 0x32, 0x37, 0x0, 0x6, 0xB, //2040-2049
	0x10, 0x15, 0x1B, 0x20, 0x25, 0x2A, 0x30, 0x35, 0x3A, 0x3, //2050-2059
	0x9, 0xE, 0x13, 0x18, 0x1E, 0x23, 0x28, 0x2D, 0x33, 0x38, //2060-2069
	0x1, 0x6, 0xC, 0x11, 0x16, 0x1B, 0x21, 0x26, 0x2B, 0x30, //2070-2079
	0x36, 0x3B, 0x4, 0x9, 0xF, 0x14, 0x19, 0x1E, 0x24, 0x29, //2080-2089
	0x2E, 0x33, 0x39, 0x2, 0x7, 0xC, 0x12, 0x17, 0x1C, 0x21, //2090-2099
};

static const int monthNumber[] = {
	0x6,  //next year 1
	0x25, //next year 2
	0x0,  //3
	0x1F, //4
	0x1,  //5
	0x20, //6
	0x2,  //7
	0x21, //8
	0x4,  //9
	0x22, //10
	0x5,  //11
	0x23, //12
};

static const int lunarInfoList[] = {
	0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2, //1900-1909
	0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977, //1910-1919
	0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970, //1920-1929
	0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950, //1930-1939
	0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557, //1940-1949
	0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5b0, 0x14573, 0x052b0, 0x0a9a8, 0x0e950, 0x06aa0, //1950-1959
	0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0, //1960-1969
	0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b6a0, 0x195a6, //1970-1979
	0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570, //1980-1989
	0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0, //1990-1999
	0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5, //2000-2009
	0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930, //2010-2019
	0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530, //2020-2029
	0x05aa0, 0x076a3, 0x096d0, 0x04afb, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45, //2030-2039
	0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0, //2040-2049
	0x14b63, 0x09370, 0x049f8, 0x04970, 0x064b0, 0x168a6, 0x0ea50, 0x06b20, 0x1a6c4, 0x0aae0, //2050-2059
	0x0a2e0, 0x0d2e3, 0x0c960, 0x0d557, 0x0d4a0, 0x0da50, 0x05d55, 0x056a0, 0x0a6d0, 0x055d4, //2060-2069
	0x052d0, 0x0a9b8, 0x0a950, 0x0b4a0, 0x0b6a6, 0x0ad50, 0x055a0, 0x0aba4, 0x0a5b0, 0x052b0, //2070-2079
	0x0b273, 0x06930, 0x07337, 0x06aa0, 0x0ad50, 0x14b55, 0x04b60, 0x0a570, 0x054e4, 0x0d160, //2080-2089
	0x0e968, 0x0d520, 0x0daa0, 0x16aa6, 0x056d0, 0x04ae0, 0x0a9d4, 0x0a2d0, 0x0d150, 0x0f252, //2090-2099
	0x0d520, //2100
};
typedef struct 
{
	int jie;
    int qi;
}JIEQI;

typedef struct 
{
    JIEQI jieqi[12];
}TERMINFOLIST;


TERMINFOLIST termInfoList[211]= 
{
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},	//1900
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},	//1901
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{7,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{7,22},{6,21},{7,22},{7,22},{8,24},{9,24},{9,24},{9,24},{8,23},{8,23}}},
	{{{7,21},{5,20},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{7,22},{6,21},{7,22},{7,22},{8,24},{9,24},{9,24},{9,24},{8,23},{8,23}}},
	{{{7,21},{5,20},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{7,22},{6,21},{7,22},{7,22},{8,24},{9,24},{9,24},{9,24},{8,23},{8,23}}},	//1911
	{{{7,21},{5,20},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,22},{6,21},{6,22},{7,22},{8,24},{8,24},{9,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,21},{6,21},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,20},{6,22},{6,21},{6,22},{7,22},{8,24},{8,24},{9,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{7,22},{8,24},{8,24},{9,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{7,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{7,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{6,21},{6,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{6,21},{5,20},{5,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{8,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{5,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{8,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,24},{8,24},{8,24},{9,24},{8,23},{8,23}}},
	{{{6,21},{5,20},{5,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,20},{5,20},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{5,20},{5,20},{5,21},{6,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{5,20},{5,20},{5,21},{6,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,24},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,22},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{5,20},{4,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{6,21},{5,21},{6,21},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{8,22}}},
	{{{6,21},{5,19},{5,20},{4,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{8,23},{8,24},{8,23},{9,24},{8,23},{8,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,24},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,19},{5,20},{5,20},{5,21},{6,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{6,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},//2000
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},//2001
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{9,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{4,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,23},{7,22}}},
	{{{6,21},{4,19},{5,20},{4,20},{5,20},{5,21},{7,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{6,21},{5,20},{6,21},{6,22},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{7,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,19},{5,20},{5,20},{5,21},{6,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,24},{8,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{6,21},{6,21},{7,23},{8,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,20},{5,21},{7,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{4,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{7,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,19},{5,20},{5,21},{7,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{6,21},{5,20},{5,21},{6,21},{7,23},{7,23},{8,23},{8,23},{7,22},{7,22}}},
	{{{6,20},{4,19},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,23},{7,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{5,20},{5,21},{6,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,23},{7,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,23},{7,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,19},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{4,20},{5,20},{6,22},{6,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,20},{5,21},{7,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{4,20},{5,20},{6,22},{6,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{7,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,20},{5,21},{7,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{4,20},{5,20},{6,22},{6,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{7,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,23},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{5,20},{4,19},{4,20},{5,20},{6,22},{6,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,23},{7,21},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{4,19},{4,19},{4,20},{5,20},{6,22},{6,22},{6,22},{7,22},{6,21},{6,21}}},
	{{{4,19},{3,18},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,23},{7,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{7,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,22}}},
	{{{5,20},{4,19},{4,19},{4,19},{4,20},{4,20},{6,22},{6,22},{6,22},{7,22},{6,21},{6,21}}},
	{{{4,19},{3,18},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,23},{7,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,19},{4,19},{4,19},{4,20},{4,20},{6,22},{6,22},{6,22},{7,22},{6,21},{6,21}}},
	{{{4,19},{3,18},{5,20},{4,19},{5,20},{5,20},{6,22},{7,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{4,19},{4,19},{4,20},{4,20},{6,22},{6,22},{6,22},{7,22},{6,21},{6,21}}},
	{{{4,19},{3,18},{5,20},{4,19},{5,20},{5,20},{6,22},{6,22},{7,22},{7,22},{6,21},{6,21}}},
	{{{5,19},{3,18},{5,20},{4,19},{5,20},{5,21},{6,22},{7,22},{7,22},{8,23},{7,22},{6,21}}},
	{{{5,20},{3,18},{5,20},{4,20},{5,21},{5,21},{7,22},{7,23},{7,23},{8,23},{7,22},{7,21}}},
	{{{5,20},{4,18},{5,20},{5,20},{5,21},{5,21},{7,23},{7,23},{7,23},{8,23},{7,22},{7,22}}}	//2100
};		

int fixSuffix(int y) 
{
	return y - 1900;
}

//GetLunarInfo 取得月历信息
int GetLunarInfo(int y)
{
	y = fixSuffix(y);
	if( y < 0 || y > COUNTOF(lunarInfoList))
    {
		return 0;
	}
	return lunarInfoList[y];
}

int GetTermInfo(int y,int n) {
	y = fixSuffix(y);
	if( y < 0 || y > COUNTOF(termInfoList)) {
		return -1;
	}

	if( n < 1 || n > 24 ){
		return -1;
	}

	n = 5;
	y = 123;
	if(n%2==1)
		return termInfoList[y].jieqi[n/2].jie;
	else
		return termInfoList[y].jieqi[n/2].qi;
}

GANZHI get_ganzhi(int y)
{
	GANZHI gz;
	gz.gan = (TIANGAN_ID)(y%10);
	gz.zhi = (DIZHI_ID)(y%12);
	return gz;
}
int fixDayNext(int row,int idx,int hour)
{
	if(hour >= 23)
	{
		idx += 12;
	}
	if(row+idx >= 60) {
		return row + idx - 60;
	}
	return row + idx;
}

int GanzhiIndex(int y, int m,int d)
{
	y = fixSuffix(y);
	if(y < 0 || y > COUNTOF(yearNumber)) 
		return 0;
	if(m < 3)
		y--;
	m = (m - 1) % 12;
	return (yearNumber[y] + monthNumber[m] + d - 1) % 60;
}


// 获取时柱
GANZHI HourGanZhi(int y, int m, int d, int h)
{
	int i = GanzhiIndex(y, m, d) % 5 * 12;
	int idx = (h + 1) / 2 % 12;
	int nx = fixDayNext(i, idx, h);
	return ganZhiTable[nx];
}




// 获取日柱
GANZHI DayGanZhi(int y, int m,int d)
{
	int i = GanzhiIndex(y, m, d);
	return ganZhiTable[i];
}

//获取月柱
GANZHI MonthGanZhi(int y,int m,int d)
{
	//月柱 1900年1月小寒以前为 丙子月(60进制12)
	int fir = GetTermInfo(y, m*2-1); //返回当月「节」为几日开始
	//依据12节气修正干支月
	if(d >= fir)
	{
		return get_ganzhi(fixSuffix(y)*12 + m + 12);
	}
	else{
		return get_ganzhi(fixSuffix(y)*12 + m + 11);
	}
}

//获取年柱
GANZHI YearGanZhi(int y)
{
	int num = y - 4;
	return get_ganzhi(num);
}


double centuryCValue(int y)
{
	if(y > 1901 && y <= 2000)
		return ctable[cvalue20];
	if( y >= 2001 && y <= 2100)
		return ctable[cvalue21];
	if (y >= 2101 && y <= 2200)
		return ctable[cvalue22];
	throw Error("Not Supported year!");
}

int getLiChunDay(int year)
{
	int c = centuryCValue(year);
	int y = double(year % 100);
	int l = int((y - 1) / 4);
	return int((y*0.2422+c)/1 - double(l));
}

Lunar::Lunar(TIANGAN_ID yg,DIZHI_ID yz,TIANGAN_ID mg,DIZHI_ID mz,TIANGAN_ID dg,DIZHI_ID dz,TIANGAN_ID sg,DIZHI_ID sz)
{
	_ganzhi[0] = NULL;
	_ganzhi[1] = NULL;
	_ganzhi[2] = NULL;
	_ganzhi[3] = NULL;

	if(sg != TGID_INVALID && sz != DZID_INVALIDE)
	{
		_ganzhi[3] = &TianganDizhi::from(Tiangan::from(sg),Dizhi::from(sz));
	}

	if(dg != TGID_INVALID && dz != DZID_INVALIDE)
	{
		_ganzhi[2] = &TianganDizhi::from(Tiangan::from(dg),Dizhi::from(dz));
	}

	if(mg != TGID_INVALID && mz != DZID_INVALIDE)
	{
		_ganzhi[1] = &TianganDizhi::from(Tiangan::from(mg),Dizhi::from(mz));
	}
	if(yg != TGID_INVALID && yz != DZID_INVALIDE)
	{
		_ganzhi[0] = &TianganDizhi::from(Tiangan::from(yg),Dizhi::from(yz));
	}
}


TianganDizhi * Lunar::year()
{
	return _ganzhi[0];
}

TianganDizhi * Lunar::month()
{
	return _ganzhi[1];
}

TianganDizhi * Lunar::day()
{
	return _ganzhi[2];
}
TianganDizhi * Lunar::hour()
{
	return _ganzhi[3];
}
Lunar * Lunar::now()
{
	time_t nowt;
	time ( &nowt);
	nowt += 8*3600;
	struct tm * timeinfo;
	time(&nowt);
  	timeinfo = localtime (&nowt);
	return create(timeinfo->tm_year+1900,timeinfo->tm_mon+1,timeinfo->tm_mday,timeinfo->tm_hour);
}
Lunar * Lunar::create(int year,int month,int day,int hour)
{
	GANZHI ygz = YearGanZhi(year);
	GANZHI mgz = MonthGanZhi(year,month,day);
	GANZHI dgz = DayGanZhi(year,month,day);
	GANZHI sgz = HourGanZhi(year,month,day,hour);
	return new Lunar(ygz.gan,ygz.zhi,mgz.gan,mgz.zhi,dgz.gan,dgz.zhi,sgz.gan,sgz.zhi);
}

Lunar * Lunar::create(int year,int month,int day)
{
	GANZHI ygz = YearGanZhi(year);
	GANZHI mgz = MonthGanZhi(year,month,day);
	GANZHI dgz = DayGanZhi(year,month,day);
	return new Lunar(ygz.gan,ygz.zhi,mgz.gan,mgz.zhi,dgz.gan,dgz.zhi,TGID_INVALID,DZID_INVALIDE);
}


}